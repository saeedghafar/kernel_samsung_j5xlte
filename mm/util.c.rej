--- mm/util.c
+++ mm/util.c
@@ -273,14 +273,17 @@ pid_t vm_is_stack(struct task_struct *task,
 
 	if (in_group) {
 		struct task_struct *t;
+		rcu_read_lock();
+		if (!pid_alive(task))
+			goto done;
 
-		rcu_read_lock();
-		for_each_thread(task, t) {
+		t = task;
+		do {
 			if (vm_is_stack_for_task(t, vma)) {
 				ret = t->pid;
 				goto done;
 			}
-		}
+		} while_each_thread(task, t);
 done:
 		rcu_read_unlock();
 	}
